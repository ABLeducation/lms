{% extends 'student_template/base_template.html' %}

{% block page_title %}
    Student Home
{% endblock page_title %}

{% block main_content %}

{% load static %}

<section class="content">
    <div class="container-fluid">
        <!-- Slider Section (Top of the Page) -->
        <div class="row">
            <div class="col-lg-12">
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
                    </ol>
                    <div class="carousel-inner" style="max-height: 300px;">  <!-- Adjust the height here -->
                        <!-- First Slide (Video) -->
                        <div class="carousel-item active">
                            <video class="d-block w-100" controls style="max-height: 300px; object-fit: cover;">
                                <source src="{% static 'video/kl_video_2.mp4' %}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>

                        <!-- Second Slide (Image) -->
                        <div class="carousel-item">
                            <img class="d-block w-100" src="{% static 'Images/kl_2.png' %}" alt="First slide" style="max-height: 300px; object-fit: cover;">
                        </div>
                        

                        <!-- Third Slide (Image) -->
                        <div class="carousel-item">
                            <img class="d-block w-100" src="{% static 'Images/kl_3.png' %}" alt="Third slide" style="max-height: 300px; object-fit: cover;">
                        </div>
                        <!-- Fourth Slide (Image) -->
                        <a href="https://kreativityleague.com/cart/" target="_blank"><div class="carousel-item">
                            <img class="d-block w-100" src="{% static 'Images/kl_4.png' %}" alt="Third slide" style="max-height: 300px; object-fit: cover;">
                        </div></a>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Cards Section -->
        <div class="row mt-3">
            <!-- Card 1: My Course -->
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>Subjects - {{ total_attendance }}</h3>
                        <p>My Course</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="{% url 'users:subjects' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>

            <!-- Card 2: My Activity Report -->
            <div class="col-lg-3 col-6">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>Login Count - {{ logs }}</h3>
                        <p>My Activity Report</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="{% url 'users:sstudent_login_activity' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>

            <!-- Card 3: My Performance -->
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        {% if attendance_absent %}
                            <h3>{{ attendance_present|floatformat:2 }} %</h3>
                        {% endif %}
                        <p>My Performance</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>

            <!-- Card 4: Leaderboard -->
            <div class="col-lg-3 col-6">
                <div class="small-box bg-success">
                    <div class="inner">
                        {% if attendance_absent %}
                            <h3>Rank - {{ attendance_absent }}</h3>
                        {% endif %}
                        <p>Leaderboard</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="{% url 'users:student_leaderboard' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>

            <!-- Card 5: Notifications -->
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        {% if unread_notifications %}
                            <h3>{{ unread_notifications }}</h3>
                        {% else %}
                            <h3>0</h3>
                        {% endif %}
                        <p>Notification</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                    <a href="{% url 'users:notification' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock main_content %}

{% block custom_js %}
<script>
    // Initialize the carousel with a default interval
    $('#carouselExampleIndicators').carousel({
        interval: 5000 // Default interval for other slides
    });

    // Select the first slide which contains the video
    var videoSlide = $('#carouselExampleIndicators .carousel-item:first-child'); // First slide

    // Add event listener for when the carousel moves to the video slide
    $('#carouselExampleIndicators').on('slide.bs.carousel', function (e) {
        if ($(e.relatedTarget).is(videoSlide)) {
            // Pause the carousel when the video slide is active
            $('#carouselExampleIndicators').carousel('pause');

            // Resume carousel after the video ends
            videoSlide.find('video').on('ended', function() {
                $('#carouselExampleIndicators').carousel('cycle'); // Resume the carousel after the video ends
            });
        }
    });

    // Pause the carousel initially if it starts with the video
    videoSlide.find('video').on('play', function() {
        $('#carouselExampleIndicators').carousel('pause');
    });

    // Resume the carousel when the video ends
    videoSlide.find('video').on('ended', function() {
        $('#carouselExampleIndicators').carousel('cycle');
    });
</script>
{% endblock custom_js %}